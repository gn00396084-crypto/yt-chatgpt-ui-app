<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>找一首歌｜故事說音樂</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body { font-family: system-ui, -apple-system, BlinkMacSystemFont; background:#fff; color:#111; padding:24px; }
    h2 { margin: 0 0 8px; }
    p { margin: 0 0 16px; line-height:1.7; }
    input { width:100%; padding:14px; font-size:16px; margin:12px 0 10px; box-sizing:border-box; }
    .hint { color:#666; font-size:13px; margin: 6px 0 14px; }
    .grid { display:grid; grid-template-columns: 1fr; gap:12px; margin-top: 10px; }
    .card {
      display:flex; gap:12px; align-items:center;
      border:1px solid #e7e7e7; border-radius:14px; padding:12px;
      text-decoration:none; color:#111;
      transition: transform .05s ease;
    }
    .card:active { transform: scale(0.99); }
    .thumb {
      width:128px; aspect-ratio:16/9; border-radius:12px;
      object-fit:cover; background:#f2f2f2; flex:0 0 auto;
    }
    .meta { flex: 1; min-width: 0; }
    .title { font-weight:750; margin:0 0 4px; font-size:15px; }
    .desc { margin:0; color:#444; font-size:13px; line-height:1.5; }
    .tag { display:inline-block; margin-top:8px; font-size:12px; color:#666; }
  </style>
</head>
<body>

<h2>不是每一次，都要找一首歌。</h2>
<p>有時，只是想被陪一會。</p>

<input id="q" placeholder="輸入歌名 / 歌手 / 狀態（例如：不聯絡、放下、雨夜）" oninput="render()" />
<div class="hint">縮圖會自動從 YouTube 連結/ID 生成；貼 youtu.be 都得。</div>

<div id="list" class="grid"></div>

<script>
  // ✅ 支援：videoId / youtu.be / watch?v= / shorts
  function extractVideoId(input) {
    if (!input) return "";
    const s = String(input).trim();

    // Already looks like an ID (avoid treating random words as IDs by requiring 6+ chars)
    if (/^[a-zA-Z0-9_-]{6,}$/.test(s) && !s.includes("http")) return s;

    try {
      const u = new URL(s);

      // youtu.be/<id>
      if (u.hostname.includes("youtu.be")) {
        return u.pathname.replace("/", "").split("?")[0];
      }

      // youtube.com/watch?v=<id>
      const v = u.searchParams.get("v");
      if (v) return v;

      // youtube.com/shorts/<id>
      const m = u.pathname.match(/\/shorts\/([^/?]+)/);
      if (m) return m[1];

      // youtube.com/embed/<id>
      const e = u.pathname.match(/\/embed\/([^/?]+)/);
      if (e) return e[1];
    } catch (_) {}

    // fallback: last try (in case user pasted just ID with spaces etc.)
    return s;
  }

  function ytThumb(input){
    const id = extractVideoId(input);
    // hqdefault 較穩；如果你要更清晰可改 maxresdefault（但有時冇）
    return `https://i.ytimg.com/vi/${encodeURIComponent(id)}/hqdefault.jpg`;
  }

  // ✅ 把 yt 填成「videoId」或「YouTube 連結」都可以
  const SONGS = [
    {
      title: "不渝",
      artist: "微光穿途",
      mood: "最新｜動態歌詞｜翻山越嶺等黎明",
      yt: "https://youtu.be/XwkdFFu9fQY"
    },
    // 你可以繼續加：
    // { title:"清空", artist:"休眠火山", mood:"告別、重新呼吸", yt:"Xxxxxxx" },
  ];

  function render(){
    const q = (document.getElementById("q").value || "").trim().toLowerCase();
    const list = document.getElementById("list");
    list.innerHTML = "";

    const filtered = SONGS.filter(s => {
      if (!q) return true;
      const hay = `${s.title} ${s.artist} ${s.mood}`.toLowerCase();
      return hay.includes(q);
    });

    filtered.forEach(s => {
      const vid = extractVideoId(s.yt);

      // 傳去故事頁：一定傳「乾淨 videoId」
      const href =
        `/ui-videos.html?title=${encodeURIComponent(s.title)}`
        + `&artist=${encodeURIComponent(s.artist)}`
        + `&mood=${encodeURIComponent(s.mood)}`
        + `&yt=${encodeURIComponent(vid)}`;

      const a = document.createElement("a");
      a.className = "card";
      a.href = href;

      a.innerHTML = `
        <img class="thumb" src="${ytThumb(vid)}" alt="thumbnail" loading="lazy" />
        <div class="meta">
          <div class="title">${escapeHtml(s.title)} — ${escapeHtml(s.artist)}</div>
          <p class="desc">${escapeHtml(s.mood || "")}</p>
          <span class="tag">點開：這首歌的故事 →</span>
        </div>
      `;

      list.appendChild(a);
    });

    if (filtered.length === 0) {
      const empty = document.createElement("p");
      empty.className = "hint";
      empty.textContent = "找不到符合的歌。你可以把這頁的 SONGS 加多幾首。";
      list.appendChild(empty);
    }
  }

  function escapeHtml(str){
    return String(str || "")
      .replaceAll("&", "&amp;")
      .replaceAll("<", "&lt;")
      .replaceAll(">", "&gt;")
      .replaceAll('"', "&quot;")
      .replaceAll("'", "&#039;");
  }

  render();
</script>

</body>
</html>
