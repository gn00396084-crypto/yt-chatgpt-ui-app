<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÊïÖ‰∫ãË™™Èü≥Ê®ÇÔΩúÊúÄÊñ∞ÂΩ±Áâá</title>

  <style>
    :root {
      --bg:#f7f7fb;
      --text:#111;
      --muted:rgba(0,0,0,.65);
      --border:rgba(0,0,0,.08);
    }
    * { box-sizing: border-box; }
    body{
      margin:0;
      font-family: system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,"PingFang TC","Noto Sans TC",sans-serif;
      background:var(--bg);
      color:var(--text);
    }

    /* ===== Header (ÂèØËá™Ë°å display:none) ===== */
    header{
      position: sticky;
      top: 0;
      z-index: 20;
      background: rgba(247,247,251,.82);
      backdrop-filter: blur(10px);
      border-bottom:1px solid var(--border);
    }
    .wrap{ max-width:1100px; margin:0 auto; padding:14px 16px; }
    .row-top{ display:flex; justify-content:space-between; align-items:center; }
    .title{ font-weight:800; }
    .nav a{
      text-decoration:none; color:#111;
      padding:8px 10px; border-radius:10px;
    }
    .nav a.active, .nav a:hover{ background:rgba(0,0,0,.06); }
    .toolbar{ margin-top:10px; display:flex; gap:10px; align-items:center; }
    .btn{ border:1px solid var(--border); background:#fff; padding:8px 12px; border-radius:10px; cursor:pointer; }
    .pill{ font-size:12px; padding:6px 10px; border:1px solid var(--border); border-radius:999px; background:#fff; }

    /* ===== Horizontal Row ===== */
    .row-wrap{
      position: relative;
      max-width:1100px;
      margin:18px auto;
      padding:0 16px;
    }
    .row{
      display:grid;
      grid-auto-flow:column;
      grid-auto-columns:minmax(240px,320px);
      gap:16px;
      overflow-x:auto;
      padding:6px 6px 12px;
      scroll-snap-type:x mandatory;
      scrollbar-width:none;
    }
    .row::-webkit-scrollbar{ display:none; }

    .row-nav{
      position:absolute;
      top:50%;
      transform:translateY(-50%);
      width:40px; height:40px;
      border-radius:12px;
      border:1px solid rgba(0,0,0,.12);
      background:#fff;
      font-size:22px;
      font-weight:800;
      cursor:pointer;
      z-index:5;
    }
    .row-nav.left{ left:6px; }
    .row-nav.right{ right:6px; }

    .g-card{
      position:relative;
      border-radius:14px;
      overflow:hidden;
      aspect-ratio:16/9;
      cursor:pointer;
      background:#eee;
      scroll-snap-align:start;
      box-shadow:0 6px 18px rgba(0,0,0,.05);
    }
    .g-card img{
      width:100%; height:100%;
      object-fit:cover;
      transition:transform .35s ease;
    }
    .g-card:hover img{ transform:scale(1.06); }

    .g-overlay{
      position:absolute; inset:0;
      background:linear-gradient(to bottom, rgba(0,0,0,0), rgba(0,0,0,.65));
      opacity:0;
      transition:.2s;
      display:flex;
      align-items:flex-end;
      padding:12px;
    }
    .g-card:hover .g-overlay{ opacity:1; }

    .g-title{
      color:#fff;
      font-size:13px;
      font-weight:700;
      text-shadow:0 2px 10px rgba(0,0,0,.4);
    }

    .g-play{
      position:absolute; inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
    }
    .g-play span{
      width:52px; height:52px;
      border-radius:50%;
      background:rgba(0,0,0,.55);
      color:#fff;
      font-size:22px;
      display:flex;
      align-items:center;
      justify-content:center;
    }

    .empty{
      max-width:1100px;
      margin:12px auto;
      padding:0 16px;
      color:var(--muted);
      white-space:pre-wrap;
    }

    /* ===== Modal (NO preset iframe) ===== */
    body.modal-open{ overflow:hidden; }

    .yt-modal{
      position:fixed; inset:0;
      display:none;
      z-index:9999;
    }
    .yt-modal.is-open{ display:block; }

    .yt-backdrop{
      position:absolute; inset:0;
      background:rgba(0,0,0,.6);
    }
    .yt-panel{
      position:relative;
      width:min(960px, calc(100vw - 24px));
      margin:6vh auto 0;
      background:#000;
      border-radius:14px;
      overflow:hidden;
    }
    .yt-close{
      position:absolute;
      top:8px; right:8px;
      width:36px; height:36px;
      border-radius:10px;
      border:0;
      background:rgba(255,255,255,.15);
      color:#fff;
      font-size:18px;
      cursor:pointer;
      z-index:2;
    }
    .yt-ratio{
      position:relative;
      width:100%;
      padding-top:56.25%;
    }
    .yt-ratio iframe{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
    }
  </style>
</head>

<body>

<header>
  <div class="wrap">
    <div class="row-top">
      <div class="title">üéß ÊúÄÊñ∞ÂΩ±Áâá</div>
      <div class="nav">
        <a class="active" href="/ui/videos">È¶ñÈ†Å</a>
        <a href="/ui/search">ÊêúÂ∞ã</a>
      </div>
    </div>
    <div class="toolbar">
      <button class="btn" onclick="loadVideos()">ÈáçÊñ∞ËºâÂÖ•</button>
      <span id="count" class="pill">‚Äî</span>
    </div>
  </div>
</header>

<div class="row-wrap">
  <button class="row-nav left" onclick="scrollRow(-1)">‚Äπ</button>
  <div id="videoRow" class="row"></div>
  <button class="row-nav right" onclick="scrollRow(1)">‚Ä∫</button>
</div>

<div id="empty" class="empty" style="display:none;"></div>

<!-- Modal -->
<div id="ytModal" class="yt-modal">
  <div class="yt-backdrop" onclick="closeYtModal()"></div>
  <div class="yt-panel">
    <button class="yt-close" onclick="closeYtModal()">‚úï</button>
    <div id="ytContainer" class="yt-ratio"></div>
  </div>
</div>

<script>
  const rowEl = document.getElementById("videoRow");
  const emptyEl = document.getElementById("empty");
  const countEl = document.getElementById("count");
  const modal = document.getElementById("ytModal");
  const ytContainer = document.getElementById("ytContainer");

  function escapeHtml(s){
    return String(s||"").replace(/[&<>"']/g, c => ({
      "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
    }[c]));
  }

  /* ===== Lazy iframe creation ===== */
  function openYtModal(videoId){
    if (!videoId || videoId.length !== 11) return;

    ytContainer.innerHTML = `
      <iframe
        src="https://www.youtube-nocookie.com/embed/${videoId}?autoplay=1&rel=0"
        frameborder="0"
        allow="autoplay; encrypted-media; picture-in-picture"
        allowfullscreen>
      </iframe>
    `;
    modal.classList.add("is-open");
    document.body.classList.add("modal-open");
  }

  function closeYtModal(){
    modal.classList.remove("is-open");
    document.body.classList.remove("modal-open");
    ytContainer.innerHTML = ""; // üî• destroy iframe
  }

  document.addEventListener("keydown", e => {
    if (e.key === "Escape" && modal.classList.contains("is-open")) closeYtModal();
  });

  function render(items){
    rowEl.innerHTML = items.map(v => `
      <div class="g-card" onclick="openYtModal('${v.videoId}')">
        <img src="${v.thumbnailUrl}" alt="">
        <div class="g-play"><span>‚ñ∂</span></div>
        <div class="g-overlay">
          <div class="g-title">${escapeHtml(v.title)}</div>
        </div>
      </div>
    `).join("");
  }

  function scrollRow(dir){
    const w = rowEl.firstElementChild?.getBoundingClientRect().width || 280;
    rowEl.scrollBy({ left: dir * (w + 16), behavior:"smooth" });
  }

  async function loadVideos(){
    emptyEl.style.display="none";
    rowEl.innerHTML="";
    countEl.textContent="Loading‚Ä¶";

    try{
      const res = await fetch("/api/videos", { cache:"no-store" });
      const text = await res.text();
      if(!res.ok) throw new Error(text);

      const data = JSON.parse(text);
      const items = (data.items || []).filter(v => v.videoId);
      countEl.textContent = `${items.length} videos`;
      render(items);
    }catch(e){
      countEl.textContent="Error";
      emptyEl.style.display="block";
      emptyEl.textContent=String(e).slice(0,800);
    }
  }

  loadVideos();
</script>
</body>
</html>
